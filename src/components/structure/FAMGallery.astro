---
import { getCollection, getEntry } from 'astro:content';
import { Image } from 'astro:assets';
import Anchor from '@components/Anchor.astro';

const posts = (await getCollection('showcase')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<section class="fam-gallery" aria-label="Gallery of project showcases">
  <div class="content" role="marquee">
    {
      posts.map(post => (
        <article class="item" aria-hidden="true" tabindex="-1">
          <div class="background">
            <figure class="media album-art" aria-hidden="true">
              {post.data.heroImage && (
                <Image width={720} height={360} src={post.data.heroImage} loading="eager" decoding="async" fetchpriority="auto" alt={post.data.description} />
              )}
            </figure>
            <div class="overlay">
              <Anchor role="button" href={`/showcase/${post.id}`}>Watch now</Anchor>
            </div>
          </div>
          <div class="copy">
            <h2 class="headline">{post.data.title}</h2>
          </div>
        </article>
      ))
    }
  </div>
</section>

<style is:global>
  section.fam-gallery {
    position: relative;
    padding-top: var(--spacing-11);
    padding-bottom: var(--spacing-11);
    & > div.content {
      display: flex;
      flex-direction: row;
      max-width: 980px;
      padding-inline-start: max(var(--spacing-sal) + 22px);
      padding-inline-end: max(var(--spacing-sar) + 22px);
      margin-left: auto;
      margin-right: auto;
      & > article.item {
        display: flex;
        position: relative;
        aspect-ratio: 2/1;
        overflow: hidden;
        background-color: var(--color-surface-primary);
        border-radius: 32px;
        & + article.item {
          margin-left: var(--spacing-05)
        }
        & > div.background {
          position: absolute;
          inset: 0;
          z-index: 0;
          & > figure.media.album-art {
            width: 100%;
            height: 100%;
            overflow: hidden;
            & > img {
              width: 100%;
              height: 100%;
              object-fit: cover;
              object-position: center;
              transition: transform .3s ease-in-out;
              @media (hover: hover) {
                article.item:hover & {
                  transform: scale(1.05)
                }
              }
            }
          }
          & > div.overlay {
            position: absolute;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: oklch(0 0 0 / 0.5);
            opacity: 0;
            transition: opacity .3s ease-in-out;
            @media (hover: hover) {
              article.item:hover & {
                opacity: 1
              }
            }
            & > a {
              padding: var(--spacing-03) var(--spacing-05);
              border-radius: 8px;
              background-color: var(--color-accent);
              color: var(--color-on-accent);
              font-size: var(--font-size-16);
              font-weight: var(--font-weight-medium);
              text-decoration: none;
              transition: background-color .3s ease-in-out, color .3s ease-in-out;
              @media (hover: hover) {
                article.item:hover & {
                  background-color: var(--color-accent-hover);
                  color: var(--color-on-accent-hover)
                }
              }
            }
          }
        }
        & > div.copy {
          position: absolute;
          bottom: var(--spacing-04);
          left: var(--spacing-04);
          z-index: 1;
          & > h2.headline {
            font-size: var(--font-size-20);
            font-weight: var(--font-weight-bold);
            line-height: 120%;
            color: var(--color-on-surface-primary)
          }
        }
      }
    }
  }
</style>