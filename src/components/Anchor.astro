---
interface Props {
  /** La variante visual del botón. */
  variant?: 'text' | 'platted';
  /** El color del botón. */
  action?: 'default' | 'neutral';
  /** El tamaño del ancla. */
  size?: 'small' | 'medium' | 'large';
  /** El ancho del botón.*/
  wide?: 'fit' | 'fill';
  /** Si el botón debe estar deshabilitado. */
  disabled?: boolean;
  /** Clases CSS adicionales para personalizar. */
  class?: string;
  /** Atributos adicionales como `onclick`, `id`, `data-*`, etc. */
  [key: string]: any;
}

// 1. Desestructurar props con valores por defecto.
const {
  variant = 'text',
  action = 'default',
  size = 'medium',
  wide = 'fit',
  disabled = false,
  class: userClass,
  href,
  ...rest
} = Astro.props;

// 2. Atributos finales para el elemento (incluye el resto de props).
// Sólo añadir `role` cuando se haya pasado como prop.
const attrs: Record<string, any> = {
  ...rest,
  disabled,
  'aria-disabled': disabled ? 'true' : undefined,
  tabindex: disabled ? -1 : undefined,
};

// 3. Construir la lista de clases dinámicamente y la clase final.
const classList = [
  'anchor',
  `variant-${variant}`,
  `action-${action}`,
  `size-${size}`,
  `wide-${wide}`,
  userClass,
].filter(Boolean);

const finalClass = classList.join(' ');

const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, '');
const subpath = pathname.match(/[^\/]+/g);
const isActive = href === pathname || href === '/' + (subpath?.[0] || '');
---
<a href={href} class={finalClass} aria-current={isActive ? 'page' : undefined} {...attrs}>
  <slot name="iconLeft" />
  <slot />
  <slot name="iconRight" />
</a>
<style>
  @layer components {
    :is(a, a[role="button"]).anchor {
      height: fit-content;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-family: var(--font-family-sans);
      font-weight: var(--font-weight-regular);
      text-align: center;
      backface-visibility: hidden;
      -webkit-font-smoothing: subpixel-antialiased;
      touch-action: manipulation;
      will-change: color, background-color, border-radius, transform;
      transition: color 150ms, background-color 150ms, border-radius 150ms, transform 150ms;
      &[aria-current="page"] {
        border-radius: 32px;
        color: var(--color-label-primary-active, oklch(0.99 0 0));
        background-color: var(--color-anchor-bg-active, oklch(0.22 0 0));
        cursor: default;
        pointer-events: none
      }
      @media (hover: hover) {
        &:hover {
          border-radius: 4px;
          transform: scale(1.03)
        }
      }
      &:active {
        border-radius: 4px;
        transform: scale(1.03)
      }
      &:focus-visible {
        outline: 2px solid var(--color-focus)
      }
      &.variant-text {
        
      }
      &.variant-platted {
        padding: 8px 10px;
        border-radius: 8px;
        background: var(--color-fill);
        color: var(--color-label-controls);
        @media (hover: hover) {
          &:hover {
            --color-anchor-hover: okchl(1 1 1 / 0.08);
            background-color: var(--color-anchor-hover)
          }
        }
      }
      &.action-default {
        color: var(--color-label-)
      }
      &.action-neutral {
        color: var(--color-label-)
      }

      &.size-small {
        font-size: var(--font-size-12);
        padding: 4px 8px;
      }
      &.size-medium {
        font-size: var(--font-size-14);
        padding: 6px 12px;
      }
      &.size-large {
        font-size: var(--font-size-16);
        padding: 8px 16px;
      }
      &.wide-fit {
        width: fit-content
      }
      &.wide-fill {
        width: 100%
      }
      &[role="button"] {
        border-radius: 32px;
        &[aria-pressed="true"] {
          
        }
      }
    }
  }
</style>